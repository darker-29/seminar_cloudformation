AWSTemplateFormatVersion: "2010-09-09"
Description: Template generated by rain

Parameters:
  Env:
    Type: String
    Default: test
  S3BucketName:
    Type: String

Resources:
  CloudFrontDistribution:
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        Comment: !Sub ${Env} CloudFront Distribution
        Enabled: true
        Origins:
          - Id: S3Origin
            DomainName: !Sub '${S3BucketName}.s3.ap-northeast-1.amazonaws.com'
            S3OriginConfig:
              OriginAccessIdentity: !Sub 'origin-access-identity/cloudfront/${CloudFrontOriginAccessIdentity}'
        DefaultRootObject: index.html
        HttpVersion: http2
          #CustomErrorResponses:
          #  - ErrorCachingMinTTL: 0
          #    ErrorCode: 404
          #    ResponseCode: 404
          #    ResponsePagePath: error.html
        DefaultCacheBehavior:
          ForwardedValues:
            QueryString: true
          TargetOriginId: S3Origin
          AllowedMethods:
            - GET
            - HEAD
          CachedMethods:
            - GET
            - HEAD
          ViewerProtocolPolicy: redirect-to-https
        PriceClass: PriceClass_200
        ViewerCertificate:
          CloudFrontDefaultCertificate: true
      Tags:
        - Key: Name
          Value: !Sub ${Env}-distribution

  CloudFrontOriginAccessIdentity:
    Type: AWS::CloudFront::CloudFrontOriginAccessIdentity
    Properties:
      CloudFrontOriginAccessIdentityConfig:
        Comment: !Sub ${Env}-origin-access-identity

