AWSTemplateFormatVersion: "2010-09-09"

Description: Template generated by rain

Resources:
  CloudFrontDistribution:
    Type: AWS::CloudFront::Distribution
    Properties:
      DistributionConfig:
        Comment: !Sub ${Env} CloudFront Distribution
        Enabled: true
        DefaultRootObject: index.html
        HttpVersion: http2
        CustomErrorResponses:
          - ErrorCachingMinTTL: 0
            ErrorCode: 404
            ResponseCode: 404
            ResponsePagePath: error.html
        DefaultCacheBehavior:
          TargetOriginId: CHANGEME
          CachePolicyId: CHANGEME # Optional
          AllowedMethods:
            - GET
            - HEAD
            - POST
            - PUT
            - DELETE
          CachedMethods:
            - GET
            - HEAD
          ViewerProtocolPolicy: redirect-to-https
        Logging:
          Bucket: !Sub ${Env}-cloudfront-log
          Prefix: !Sub ${Env}-cloudfront/
          IncludeCookies: false
        PriceClass: PriceClass_200
        ViewerCertificate:
          CloudFrontDefaultCertificate: true
          # AcmCertificateArn: CHANGEME # Optional
          # IamCertificateId: CHANGEME # Optional
          # MinimumProtocolVersion: CHANGEME # Optional
          # SslSupportMethod: CHANGEME # Optional
      Tags:
        - Key: Name
          Value: !Sub ${Env}-distribution

  CloudFrontOriginAccessIdentity:
    Type: AWS::CloudFront::CloudFrontOriginAccessIdentity
    Properties:
      CloudFrontOriginAccessIdentityConfig:
        Comment: !Sub ${Env}-origin-access-identity

  CachePolicy:
    Type: AWS::CloudFront::CachePolicy
    Properties:
      CachePolicyConfig:
        Comment: CHANGEME # Optional
        DefaultTTL: 0
        MaxTTL: 0
        MinTTL: 0
        Name: CHANGEME
        ParametersInCacheKeyAndForwardedToOrigin:
          CookiesConfig:
            CookieBehavior: CHANGEME
            Cookies: # Optional
              - CHANGEME
          EnableAcceptEncodingBrotli: false # Optional
          EnableAcceptEncodingGzip: false
          HeadersConfig:
            HeaderBehavior: CHANGEME
            Headers: # Optional
              - CHANGEME
          QueryStringsConfig:
            QueryStringBehavior: CHANGEME
            QueryStrings: # Optional
              - CHANGEME

Outputs:
  MyCachePolicyId:
    Value: !GetAtt MyCachePolicy.Id

  MyCachePolicyLastModifiedTime:
    Value: !GetAtt MyCachePolicy.LastModifiedTime

