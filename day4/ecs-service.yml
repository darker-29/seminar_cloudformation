AWSTemplateFormatVersion: "2010-09-09"
Description: Template generated by rain

Parameters:
  Env:
    Type: String
    Default: test

Resources:
  ECSService:
    Type: AWS::ECS::Service
    Properties:
      ServiceName: !Sub ${Env}-service
      TaskDefinition:
        Fn::ImportValue:
          !Sub ${Env}-task
      LaunchType: FARGATE
      PlatformVersion: 1.4.0
      SchedulingStrategy: REPLICA
      Cluster:
        Fn::ImportValue:
          !Sub ${Env}-cluster
      DeploymentController:
        Type: ECS
      DesiredCount: 1
      EnableECSManagedTags: true
      PropagateTags: TASK_DEFINITION
      EnableExecuteCommand: true
      HealthCheckGracePeriodSeconds: 60
      LoadBalancers:
        - ContainerName:
            Fn::ImportValue:
              !Sub ${Env}-web
          ContainerPort: 80
          LoadBalancerName:
            Fn::ImportValue:
              !Sub ${Env}-ApplicationLoadBalancer
          TargetGroupArn:
            Fn::ImportValue:
              !Sub ${Env}-TargetGroup
      NetworkConfiguration:
        AwsvpcConfiguration:
          AssignPublicIp: DISABLED
          SecurityGroups:
            - Fn::ImportValue:
                !Sub ${Env}-ECSSecutiryGroup
          Subnets:
            - Fn::ImportValue:
                !Sub ${Env}-PrivateSubnet1a
            - Fn::ImportValue:
                !Sub ${Env}-PrivateSubnet1c
      Role: CHANGEME # Optional
      ServiceArn: CHANGEME # Optional
      ServiceRegistries:
        - ContainerName: CHANGEME # Optional
          ContainerPort: 0 # Optional
          Port: 0 # Optional
          RegistryArn: CHANGEME # Optional
      Tags:
        - Key: Name
          Value: !Sub ${Env}-ecs-service

